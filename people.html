<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Animated Gap Fill Quiz</title>
  <style>
    body {
      background-color: #111;
      color: #fff;
      font-family: 'Arial', sans-serif;
      padding: 2rem;
      text-align: center;
    }

    h1 {
      color: #7ad1d4;
      font-size: 2rem;
      margin-bottom: 1.5rem;
    }

    .progress-container {
      width: 100%;
      max-width: 700px;
      height: 20px;
      background-color: #333;
      border-radius: 25px;
      overflow: hidden;
      margin: 1rem auto 2rem;
    }

    .progress-bar {
      height: 100%;
      width: 0%;
      background-color: #7ad1d4;
      transition: width 0.4s ease;
    }

    .nav-grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 2rem;
    }

    .nav-grid button {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      font-weight: bold;
      border: none;
      cursor: pointer;
      background-color: #444;
      color: #fff;
    }

    .nav-grid button.active {
      background-color: #7ad1d4;
      color: #000;
    }

    .nav-grid button.answered:not(.active) {
      background-color: #2b996e;
    }

    .conversation {
      max-width: 700px;
      margin: 0 auto;
      font-size: 1.2rem;
      line-height: 1.6;
      text-align: left;
      background-color: #000;
      padding: 1.5rem;
      border-radius: 10px;
      border: 1px solid #444;
      display: none;
    }

    .conversation.active {
      display: block;
    }

    select {
      background: #222;
      color: white;
      padding: 0.4rem;
      font-weight: bold;
      border-radius: 4px;
      border: 1px solid #555;
      margin-left: 0.4rem;
    }

    select:hover {
      background-color: #7ad1d4;
      color: black;
      cursor: pointer;
    }

    .feedback {
      margin-top: 1rem;
      font-size: 1.1rem;
    }

    .correct {
      color: lightgreen;
    }

    .incorrect {
      color: #ff4c4c;
    }

    .controls {
      margin-top: 1.5rem;
    }

    button {
      margin: 0.4rem;
      padding: 10px 20px;
      font-weight: bold;
      background-color: #7ad1d4;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    #summary {
      margin-top: 2rem;
      font-size: 1.2rem;
      font-weight: bold;
    }

    #completedBanner {
      margin-top: 2rem;
      font-size: 1.3rem;
      font-weight: bold;
      color: #00ffaa;
      display: none;
    }
  </style>
</head>
<body>

<h1>Fill in the Missing Word</h1>

<div class="progress-container">
  <div class="progress-bar" id="progressBar"></div>
</div>

<div class="nav-grid" id="navGrid"></div>

<div id="quizContainer"></div>

<div class="controls" id="controlBtns">
  <button onclick="prevStep()">‚¨ÖÔ∏è Back</button>
  <button onclick="validateStep()">‚úÖ Check</button>
  <button onclick="nextStep()">‚û°Ô∏è Next</button>
</div>

<div id="summary"></div>
<div id="completedBanner">üéâ You've completed the quiz!</div>
<button onclick="resetQuiz()" id="resetBtn" style="display:none;">üîÅ Restart Quiz</button>

<script>
  const originalQuestions = [
    {
      dialogue: `<strong>Paul:</strong> Which ethnic group built all these beautiful towers again?<br>
                 <strong>Jamie:</strong> Oh, that'd be the`,
      options: [
        { value: "complain", text: "Cham" },
        { value: "hide", text: "Khmer" },
        { value: "speak up", text: "Stieng" }
      ],
      answer: "complain",
      feedbackCorrect: "‚úÖ Correct! The Cham built many Hindu-style towers.",
      feedbackIncorrect: "‚ùå Incorrect. Think about Hindu influence."
    },
    {
      dialogue: `<strong>Alex:</strong> That lady with large bone earrings - what's her ethnic group again?<br>
                 <strong>Jamie:</strong> Oh, she'd be`,
      options: [
        { value: "courage", text: "Stieng" },
        { value: "luck", text: "Hoa" },
        { value: "time", text: "Khmer" }
      ],
      answer: "courage",
      feedbackCorrect: "‚úÖ Correct! Stieng people wear traditional bone earrings.",
      feedbackIncorrect: "‚ùå Incorrect. Look for distinctive traditions."
    }
  ];

  let currentStep = 0;
  let shuffledQuestions = [];
  let score = 0;
  const answers = {};

  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  function renderQuiz() {
    shuffledQuestions = shuffle([...originalQuestions]);
    const container = document.getElementById("quizContainer");
    const nav = document.getElementById("navGrid");
    container.innerHTML = '';
    nav.innerHTML = '';

    shuffledQuestions.forEach((q, i) => {
      const convo = document.createElement("div");
      convo.className = "conversation";
      convo.id = `step${i}`;
      if (i === 0) convo.classList.add("active");

      convo.innerHTML = `
        <p>${q.dialogue}
          <select id="q${i}">
            <option value="">--select--</option>
            ${q.options.map(opt => `<option value="${opt.value}">${opt.text}</option>`).join('')}
          </select>.
        </p>
        <div class="feedback" id="feedback${i}"></div>
      `;
      container.appendChild(convo);

      const navBtn = document.createElement("button");
      navBtn.textContent = i + 1;
      navBtn.id = `navBtn${i}`;
      navBtn.onclick = () => showStep(i);
      nav.appendChild(navBtn);
    });

    updateProgress();
    updateNavStyles();
  }

  function showStep(index) {
    document.querySelectorAll('.conversation').forEach(el => el.classList.remove('active'));
    document.getElementById(`step${index}`).classList.add("active");
    currentStep = index;
    updateNavStyles();
  }

  function prevStep() {
    if (currentStep > 0) showStep(currentStep - 1);
  }

  function nextStep() {
    if (currentStep < shuffledQuestions.length - 1) {
      showStep(currentStep + 1);
    } else {
      finishQuiz();
    }
  }

  function validateStep() {
    const select = document.getElementById(`q${currentStep}`);
    const feedback = document.getElementById(`feedback${currentStep}`);
    const value = select.value;
    const q = shuffledQuestions[currentStep];

    if (!value) {
      feedback.innerHTML = `<span class="incorrect">‚ùå Please select an answer.</span>`;
      return;
    }

    const navBtn = document.getElementById(`navBtn${currentStep}`);
    navBtn.classList.add("answered");

    if (value === q.answer) {
      if (!answers[currentStep]) {
        score++;
        answers[currentStep] = true;
      }
      feedback.innerHTML = `<span class="correct">${q.feedbackCorrect}</span>`;
    } else {
      answers[currentStep] = false;
      feedback.innerHTML = `<span class="incorrect">${q.feedbackIncorrect}</span>`;
    }

    updateProgress();
    updateNavStyles();

    if (Object.keys(answers).length === shuffledQuestions.length) {
      finishQuiz();
    }
  }

  function updateProgress() {
    const percent = (Object.keys(answers).length / shuffledQuestions.length) * 100;
    document.getElementById("progressBar").style.width = `${percent}%`;
  }

  function updateNavStyles() {
    shuffledQuestions.forEach((_, i) => {
      const btn = document.getElementById(`navBtn${i}`);
      btn.classList.remove("active");
    });
    document.getElementById(`navBtn${currentStep}`).classList.add("active");
  }

  function finishQuiz() {
    const percent = (score / shuffledQuestions.length) * 100;
    const summary = document.getElementById("summary");
    const banner = document.getElementById("completedBanner");

    summary.style.color = percent >= 50 ? "lightgreen" : "#ff4c4c";
    summary.innerHTML = percent >= 50
      ? `‚úÖ You passed with ${percent.toFixed(0)}% (${score}/${shuffledQuestions.length})`
      : `‚ùå You got ${percent.toFixed(0)}%. Try again. (${score}/${shuffledQuestions.length})`;

    banner.style.display = "block";
    document.getElementById("controlBtns").style.display = "none";
    document.getElementById("resetBtn").style.display = "inline-block";
  }

  function resetQuiz() {
    currentStep = 0;
    score = 0;
    for (let key in answers) delete answers[key];
    document.getElementById("summary").innerHTML = "";
    document.getElementById("completedBanner").style.display = "none";
    document.getElementById("resetBtn").style.display = "none";
    document.getElementById("controlBtns").style.display = "block";
    renderQuiz();
  }

  // Init
  renderQuiz();
</script>

</body>
</html>
