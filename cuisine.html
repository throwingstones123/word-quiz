<body>
  <h1>Vietnamese Cuisine Quiz</h1>
  <div class="progress-container">
    <div class="progress-bar" id="progressBar"></div>
  </div>
  <div class="nav-grid" id="navGrid"></div>
  <div class="quiz-container" id="quizContainer"></div>
  <div class="nav-buttons">
    <button onclick="prevQuestion()" id="prevBtn">Previous</button>
    <button class="check-btn" onclick="checkAnswer(currentQuestion)" id="checkBtn">Check</button>
    <button onclick="nextQuestion()" id="nextBtn" disabled>Next</button>
    <button onclick="grade()" id="submitBtn" style="display: none;">Submit</button>
  </div>
  <p id="result"></p>
  <p id="summary"></p>
  <div style="text-align: center;">
    <button onclick="resetQuiz()" id="resetBtn" style="display: none;">üîÅ Reattempt Quiz</button>
  </div>
  <script>
    const originalQuestions = [
      {
        text: "I'm down for something protein tonight! What should we be having? (Hint: Vietnamese grilled beef in lolot leaves)",
        answer: "Lolot Beef",
        explanation: "Lolot Beef (B√≤ l√° l·ªët) is a traditional Vietnamese dish of grilled beef wrapped in lolot leaves.",
        hint: "It's a grilled beef dish wrapped in leaves."
      },
      {
        text: "What rice-based dish comes with eggs and smoked pork, common in the south? (Hint: Popular street breakfast)",
        answer: "Broken Rice",
        explanation: "Broken Rice (C∆°m t·∫•m) is a Vietnamese dish made from fractured rice grains, usually served with grilled meats, eggs, and smoked pork.",
        hint: "Rice grains are not whole; popular in Saigon."
      },
      // ... Add more question objects in this format (text, answer, explanation, hint)
    ];

    let shuffledQuestions = [];
    let currentQuestion = 0;
    const answers = {};
    const validated = {};
    const quizContainer = document.getElementById("quizContainer");
    const navGrid = document.getElementById("navGrid");

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function renderQuestions() {
      quizContainer.innerHTML = "";
      navGrid.innerHTML = "";
      shuffledQuestions = shuffle([...originalQuestions]);
      Object.keys(validated).forEach(k => delete validated[k]);
      Object.keys(answers).forEach(k => delete answers[k]);
      shuffledQuestions.forEach((q, i) => {
        const card = document.createElement("div");
        card.className = "question-card";
        card.id = `card${i}`;
        if (i === 0) card.classList.add("active");
        card.innerHTML = `
          <p>${q.text}</p>
          <input type="text" id="q${i}" autocomplete="off" placeholder="Type your answer here">
          <div class="feedback" id="feedback${i}"></div>
        `;
        quizContainer.appendChild(card);

        const navBtn = document.createElement("button");
        navBtn.textContent = i + 1;
        navBtn.onclick = () => goToQuestion(i);
        navBtn.id = `navBtn${i}`;
        navGrid.appendChild(navBtn);
      });
      updateProgress();
      highlightNav();
      updateNavButtons();
      updateCheckButton();
    }

    function normalize(str) {
      return str.trim().toLowerCase();
    }

    function checkAnswer(index) {
      const input = document.getElementById(`q${index}`);
      const userInput = normalize(input.value);
      const correctAnswer = normalize(shuffledQuestions[index].answer);
      const feedback = document.getElementById(`feedback${index}`);

      if (!userInput) {
        feedback.innerHTML = "‚ùå Please type your answer.";
        feedback.className = "feedback";
        return;
      }

      answers[`q${index}`] = input.value;
      if (userInput === correctAnswer) {
        feedback.innerHTML = `‚úÖ Correct! ${shuffledQuestions[index].explanation}`;
        feedback.className = "feedback correct";
      } else {
        feedback.innerHTML = `‚ùå Incorrect. Hint: ${shuffledQuestions[index].hint}`;
        feedback.className = "feedback";
      }
      validated[index] = true;
      document.getElementById(`navBtn${index}`).classList.add("answered");
      if (index === shuffledQuestions.length - 1) {
        document.getElementById("submitBtn").style.display = "inline-block";
      }
      updateProgress();
      updateNavButtons();
    }

    function updateCheckButton() {
      document.getElementById('checkBtn').onclick = function() { checkAnswer(currentQuestion); };
    }

    function updateNavButtons() {
      document.getElementById("prevBtn").style.display = currentQuestion === 0 ? "none" : "inline-block";
      const nextBtn = document.getElementById("nextBtn");
      if (currentQuestion === shuffledQuestions.length - 1) {
        nextBtn.style.display = "none";
      } else {
        nextBtn.style.display = "inline-block";
        nextBtn.disabled = !validated[currentQuestion];
      }
      document.getElementById("submitBtn").style.display = (currentQuestion === shuffledQuestions.length - 1 && validated[currentQuestion]) ? "inline-block" : "none";
      updateCheckButton();
    }

    function showQuestion(index) {
      document.querySelectorAll(".question-card").forEach(card => card.classList.remove("active"));
      document.getElementById(`card${index}`).classList.add("active");
      currentQuestion = index;
      highlightNav();
      updateNavButtons();
    }

    function goToQuestion(index) {
      showQuestion(index);
    }

    function prevQuestion() {
      if (currentQuestion > 0) showQuestion(currentQuestion - 1);
    }

    function nextQuestion() {
      if (currentQuestion < shuffledQuestions.length - 1 && validated[currentQuestion]) showQuestion(currentQuestion + 1);
    }

    function highlightNav() {
      for (let i = 0; i < shuffledQuestions.length; i++) {
        document.getElementById(`navBtn${i}`).classList.remove("active");
      }
      document.getElementById(`navBtn${currentQuestion}`).classList.add("active");
    }

    function updateProgress() {
      const percent = (Object.keys(validated).length / shuffledQuestions.length) * 100;
      document.getElementById("progressBar").style.width = percent + "%";
    }

    function grade() {
      let score = 0;
      shuffledQuestions.forEach((q, i) => {
        const userInput = normalize(answers[`q${i}`] || "");
        const correctAnswer = normalize(q.answer);
        const feedback = document.getElementById(`feedback${i}`);
        if (userInput === correctAnswer) {
          score++;
          feedback.className = "feedback correct";
        } else {
          feedback.textContent = `‚ùå Incorrect. Hint: ${q.hint}`;
          feedback.className = "feedback";
        }
      });
      const percent = (score / shuffledQuestions.length) * 100;
      document.getElementById("result").textContent = `You got ${score} out of ${shuffledQuestions.length} correct.`;
      document.getElementById("summary").textContent = percent >= 50
        ? `‚úÖ Well done! You passed with ${percent.toFixed(0)}%.`
        : `‚ùå You got ${percent.toFixed(0)}%. Keep practicing!`;
      document.getElementById("summary").style.color = percent >= 50 ? "lightgreen" : "#ff4c4c";
      document.getElementById("resetBtn").style.display = "inline-block";
    }

    function resetQuiz() {
      currentQuestion = 0;
      for (let key in answers) delete answers[key];
      for (let key in validated) delete validated[key];
      document.getElementById("result").textContent = "";
      document.getElementById("summary").textContent = "";
      document.getElementById("resetBtn").style.display = "none";
      renderQuestions();
      showQuestion(currentQuestion);
    }

    renderQuestions();
    showQuestion(currentQuestion);
  </script>
</body>
