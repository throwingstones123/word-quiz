<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Step-by-Step Gap Fill Quiz</title>
  <style>
    body {
      background-color: #111;
      color: #fff;
      font-family: 'Arial', sans-serif;
      padding: 2rem;
      text-align: center;
    }

    h1 {
      color: #7ad1d4;
      font-size: 2rem;
      margin-bottom: 2rem;
    }

    .progress-container {
      width: 100%;
      background-color: #333;
      border-radius: 25px;
      overflow: hidden;
      margin: 1rem auto 2rem;
      max-width: 600px;
      height: 20px;
    }

    .progress-bar {
      height: 100%;
      background-color: #7ad1d4;
      width: 0%;
      transition: width 0.5s ease-in-out;
    }

    .nav-grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.5rem;
      max-width: 600px;
      margin: 0 auto 2rem;
    }

    .nav-grid button {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      font-weight: bold;
      border: none;
      cursor: pointer;
      background-color: #444;
      color: #fff;
    }

    .nav-grid button.active {
      background-color: #7ad1d4;
      color: #000;
    }

    .nav-grid button.answered:not(.active) {
      background-color: #2b996e;
    }

    .conversation {
      max-width: 700px;
      margin: 0 auto;
      font-size: 1.2rem;
      line-height: 1.6;
      text-align: left;
      background-color: #000;
      padding: 1.5rem;
      border-radius: 10px;
      border: 1px solid #444;
      display: none;
    }

    .conversation.active {
      display: block;
      animation: fadeIn 0.8s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    select {
      background: #222;
      color: white;
      padding: 0.4rem;
      font-weight: bold;
      border-radius: 4px;
      border: 1px solid #555;
      margin: 0 0.2rem;
    }

    select:hover {
      background-color: #7ad1d4;
      color: black;
      cursor: pointer;
    }

    button {
      margin-top: 1rem;
      padding: 10px 20px;
      font-weight: bold;
      background-color: #7ad1d4;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      color: #000;
    }

    .feedback {
      margin-top: 1rem;
      font-size: 1.1rem;
    }

    .correct {
      color: lightgreen;
    }

    .incorrect {
      color: #ff4c4c;
    }

    .summary {
      margin-top: 2rem;
      font-size: 1.3rem;
      font-weight: bold;
    }
  </style>
</head>
<body>

<h1>Fill in the Missing Word</h1>

<div class="progress-container">
  <div class="progress-bar" id="progressBar"></div>
</div>

<div class="nav-grid" id="navGrid"></div>
<div id="quizContainer"></div>

<div class="summary">
  <p id="finalFeedback"></p>
  <p id="scoreSummary"></p>
  <button onclick="resetQuiz()" id="resetBtn" style="display:none;">üîÅ Reattempt Quiz</button>
</div>

<script>
  const originalQuestions = [
    {
      id: "step1",
      dialogue: `<strong>Alex:</strong> What's that white flower over there that they're decorating around the temple? They're so pretty!
                 <br><strong>Jamie:</strong> Oh? that's the `,
      options: [
        { value: "complain", text: "White Rose" },
        { value: "hide", text: "Frangipani" },
        { value: "speak up", text: "Lily" }
      ],
      answer: "hide",
      feedbackCorrect: "‚úÖ That's correct! Frangipani is widely used in ceremonies.",
      feedbackIncorrect: "‚ùå That's not right. Think about which flower is common in spiritual rituals."
    },
    {
      id: "step2",
      dialogue: `<strong>Kyle:</strong> Hey Qu·ª≥nh - I just got back from Hoi An. Saw lots of these papery-looking flowers in white and purple, do you know them?
                 <br><strong>Qu·ª≥nh:</strong> That should be the `,
      options: [
        { value: "courage", text: "Bougainvillea" },
        { value: "luck", text: "Poppy" },
        { value: "time", text: "Sunflower" }
      ],
      answer: "courage",
      feedbackCorrect: "‚úÖ Well done! Bougainvillea is known for its symbolism in many cultures.",
      feedbackIncorrect: "‚ùå Not quite. Try again and think about the vibrant colors and strength."
    },
    {
      id: "step3",
      dialogue: `<strong>Kyle:</strong> So they're flowers that most school grow? That's such an amazing view
                 <br><strong>Qu·ª≥nh:</strong> There's a reason they're known as ______ flowers , after all! `, 
      options: [
        { value: "courage", text: "Burgundy" },
        { value: "luck", text: "Peacock" },
        { value: "time", text: "Rosemary" }
      ],
      answer: "Peacock",
      feedbackCorrect: "‚úÖ Well done! Peacock is especially tied to Vietnamese student life",
      feedbackIncorrect: "‚ùå Not quite. Try again and think about the environment that they're mentioning"
    }
  ];

  let shuffledQuestions = [];
  let score = 0;
  let current = 0;
  const answers = {};

  const quizContainer = document.getElementById("quizContainer");
  const navGrid = document.getElementById("navGrid");

  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  function renderQuestions() {
    quizContainer.innerHTML = "";
    navGrid.innerHTML = "";
    shuffledQuestions = shuffle([...originalQuestions]);

    shuffledQuestions.forEach((q, i) => {
      const card = document.createElement("div");
      card.className = "conversation";
      card.id = `card${i}`;
      if (i === 0) card.classList.add("active");

      const selectOptions = q.options.map(opt =>
        `<option value="${opt.value}">${opt.text}</option>`).join("");

      card.innerHTML = `
        <p>${q.dialogue}
        <select id="q${i}">
          <option value="">--select--</option>
          ${selectOptions}
        </select>.</p>
        <div class="feedback" id="feedback${i}"></div>
        <button onclick="checkAnswer(${i})">Check</button>
      `;

      quizContainer.appendChild(card);

      const navBtn = document.createElement("button");
      navBtn.textContent = i + 1;
      navBtn.onclick = () => showQuestion(i);
      navBtn.id = `navBtn${i}`;
      navGrid.appendChild(navBtn);
    });

    updateProgress();
    highlightNav();
  }

  function showQuestion(index) {
    document.querySelectorAll(".conversation").forEach(c => c.classList.remove("active"));
    document.getElementById(`card${index}`).classList.add("active");
    current = index;
    highlightNav();
  }

  function checkAnswer(index) {
    const select = document.getElementById(`q${index}`);
    const feedback = document.getElementById(`feedback${index}`);
    const value = select.value;
    const q = shuffledQuestions[index];

    if (!value) return;

    if (value === q.answer) {
      feedback.innerHTML = `<span class="correct">${q.feedbackCorrect}</span>`;
      if (!answers[index]) {
        answers[index] = true;
        score++;
        document.getElementById(`navBtn${index}`).classList.add("answered");
      }
    } else {
      feedback.innerHTML = `<span class="incorrect">${q.feedbackIncorrect}</span>`;
      answers[index] = false;
    }

    updateProgress();

    if (Object.keys(answers).length === shuffledQuestions.length) {
      showFinalMessage();
    }
  }

  function highlightNav() {
    shuffledQuestions.forEach((_, i) => {
      document.getElementById(`navBtn${i}`).classList.remove("active");
    });
    document.getElementById(`navBtn${current}`).classList.add("active");
  }

  function updateProgress() {
    const percent = (Object.keys(answers).length / shuffledQuestions.length) * 100;
    document.getElementById("progressBar").style.width = `${percent}%`;
  }

  function showFinalMessage() {
    const finalFeedback = document.getElementById("finalFeedback");
    const scoreSummary = document.getElementById("scoreSummary");
    const percent = (score / shuffledQuestions.length) * 100;

    finalFeedback.innerHTML = `<span class="correct">üéâ You've completed the quiz!</span>`;
    scoreSummary.innerHTML = percent >= 50
      ? `‚úÖ Score: ${score}/${shuffledQuestions.length} ‚Äî You passed with ${percent.toFixed(0)}%.`
      : `‚ùå Score: ${score}/${shuffledQuestions.length} ‚Äî Try again! You got ${percent.toFixed(0)}%.`;

    document.getElementById("resetBtn").style.display = "inline-block";
  }

  function resetQuiz() {
    score = 0;
    current = 0;
    for (let key in answers) delete answers[key];
    document.getElementById("finalFeedback").innerHTML = "";
    document.getElementById("scoreSummary").innerHTML = "";
    document.getElementById("resetBtn").style.display = "none";
    renderQuestions();
    showQuestion(0);
  }

  renderQuestions();
</script>
</body>
</html>
